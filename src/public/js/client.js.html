<!DOCTYPE html><html><head><title>client.js</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../../index.html" class="source"><span class="file_name">README</span></a><a href="../../../src/providers/RawArticleProvider.js.html" class="source "><span class="base_path">src / providers / </span><span class="file_name">RawArticleProvider.js</span></a><a href="../../../src/public/js/app.js.html" class="source "><span class="base_path">src / public / js / </span><span class="file_name">app.js</span></a><a href="../../../src/public/js/ArticleIndexView.js.html" class="source "><span class="base_path">src / public / js / </span><span class="file_name">ArticleIndexView.js</span></a><a href="../../../src/public/js/ArticleViewModel.js.html" class="source "><span class="base_path">src / public / js / </span><span class="file_name">ArticleViewModel.js</span></a><a href="../../../src/public/js/client.js.html" class="source selected"><span class="base_path">src / public / js / </span><span class="file_name">client.js</span></a><a href="../../../src/public/js/iPadScroller.js.html" class="source "><span class="base_path">src / public / js / </span><span class="file_name">iPadScroller.js</span></a><a href="../../../src/public/js/MapView.js.html" class="source "><span class="base_path">src / public / js / </span><span class="file_name">MapView.js</span></a><a href="../../../src/public/js/Models.js.html" class="source "><span class="base_path">src / public / js / </span><span class="file_name">Models.js</span></a><a href="../../../src/public/js/NarrationView.js.html" class="source "><span class="base_path">src / public / js / </span><span class="file_name">NarrationView.js</span></a><a href="../../../src/public/js/TimelineView.js.html" class="source "><span class="base_path">src / public / js / </span><span class="file_name">TimelineView.js</span></a><a href="../../../src/routes/routes.js.html" class="source "><span class="base_path">src / routes / </span><span class="file_name">routes.js</span></a><a href="../../../src/server.js.html" class="source "><span class="base_path">src / </span><span class="file_name">server.js</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>client.js</h1><div class="filepath">src/public/js/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><p>This entrypoint provides only one functionality: <strong>Asynchronous Module Loading</strong>. This is a poor man's Require.js. 
This script loader is built for easy debugging - it doesn't provide any real modules, it just loads the defined set of scripts.
Currently it enforces an order on scripts - it completely loads one script before the next one is started, again making development easier.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Cache buster appends a random string to each script request, which makes sure
scripts doesn't get cached. This is useful for development and killer for production!
We create an immediately evaluated anonymous function to wrap the local state.</p>
</td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">cacheBustify</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">defaultVal</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">today</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">cachebuster</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10000000000000000</span><span class="p">);</span>
  
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">overrideDefault</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span>   <span class="p">(</span><span class="nx">overrideDefault</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">overrideDefault</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span>
        <span class="o">||</span> <span class="p">(</span><span class="nx">defaultVal</span> <span class="o">&amp;&amp;</span> <span class="nx">overrideDefault</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">src</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;?cb=&quot;</span> <span class="o">+</span> <span class="nx">cachebuster</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">src</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
<span class="p">})(</span><span class="kc">true</span><span class="p">);</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>The queue stores all elements to load.</p>
</td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">queue</span> <span class="o">=</span> <span class="p">[];</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>requireScript creates a script tag with the given source, and adds it to the queue of scripts waiting to be loaded.</p>
</td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">requireScript</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">bustCache</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">src</span> <span class="o">=</span> <span class="nx">cacheBustify</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span><span class="nx">bustCache</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">jsElement</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span>
  <span class="nx">jsElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;text/javascript&#39;</span><span class="p">);</span>
  <span class="nx">jsElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;charset&#39;</span><span class="p">,</span><span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>  
  <span class="nx">jsElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="nx">src</span><span class="p">);</span>
  <span class="nx">queue</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span><span class="s1">&#39;js&#39;</span><span class="p">,</span> <span class="nx">elem</span><span class="o">:</span><span class="nx">jsElement</span><span class="p">});</span>
<span class="p">}</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Here we asynchronously load every script one after another.
We register listener for a script to complete loading, which triggers the next script's load.</p>
</td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">loadAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">function</span> <span class="nx">loadNext</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Get an element from the queue of scripts waiting to be loaded</p>
</td><td class="code"><div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">elem</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">isCSS</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;css&#39;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">isLess</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;less&#39;</span><span class="p">;</span>
  
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Loading&quot;</span><span class="p">,</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">));</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Register this function to run when the script is done, and add it to the document. The appendChild has the effect of starting the script load.</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">elem</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">loadNext</span><span class="p">;</span>          
      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;head&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">elem</span><span class="p">);</span>   
  
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">loadNext</span><span class="p">();</span>
  
<span class="p">}</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><h3>Order Matters</h3>

<p>It is up to you to linearize your dependencies (or handle them in a fancy way), 
we load scripts in the order defined here:</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><h3>Libaries</h3>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>jQuery simplifies working with the DOM</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">requireScript</span><span class="p">(</span><span class="s2">&quot;/jslibs/jquery-2.0.2.min.js&quot;</span><span class="p">,</span>   <span class="kc">false</span><span class="p">);</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Underscore provides functional programming for javascript</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">requireScript</span><span class="p">(</span><span class="s1">&#39;/jslibs/underscore-min.js&#39;</span><span class="p">,</span>     <span class="kc">false</span><span class="p">);</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Backbone provides a simple router, event, model and view system</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">requireScript</span><span class="p">(</span><span class="s1">&#39;/jslibs/backbone-min.js&#39;</span><span class="p">,</span>       <span class="kc">false</span><span class="p">);</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Raphael provides a library over SVG graphics, used for our timeline.</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">requireScript</span><span class="p">(</span><span class="s1">&#39;/jslibs/raphael-min.js&#39;</span><span class="p">,</span>        <span class="kc">false</span><span class="p">);</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Async provides functional programming abstractions to work with asynchronous calls</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">requireScript</span><span class="p">(</span><span class="s1">&#39;/jslibs/async.js&#39;</span><span class="p">,</span>              <span class="kc">false</span><span class="p">);</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Base64 provides methods useful for doing data-uri encoding.</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">requireScript</span><span class="p">(</span><span class="s1">&#39;/jslibs/Base64.js&#39;</span><span class="p">,</span>             <span class="kc">false</span><span class="p">);</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><h3>App modules</h3>
</td><td class="code"><div class="highlight"><pre><span class="nx">requireScript</span><span class="p">(</span><span class="s1">&#39;/js/iPadScroller.js&#39;</span><span class="p">);</span>

<span class="nx">requireScript</span><span class="p">(</span><span class="s1">&#39;/js/Models.js&#39;</span><span class="p">);</span>

<span class="nx">requireScript</span><span class="p">(</span><span class="s1">&#39;/js/ArticleViewModel.js&#39;</span><span class="p">);</span>
<span class="nx">requireScript</span><span class="p">(</span><span class="s1">&#39;/js/ArticleIndexView.js&#39;</span><span class="p">);</span>

<span class="nx">requireScript</span><span class="p">(</span><span class="s1">&#39;/js/MapView.js&#39;</span><span class="p">);</span>
<span class="nx">requireScript</span><span class="p">(</span><span class="s1">&#39;/js/NarrationView.js&#39;</span><span class="p">);</span>
<span class="nx">requireScript</span><span class="p">(</span><span class="s1">&#39;/js/TimelineView.js&#39;</span><span class="p">);</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Our very last script to load is the app's initialization module, where everything is started.</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">requireScript</span><span class="p">(</span><span class="s1">&#39;/js/app.js&#39;</span><span class="p">);</span>

<span class="nx">loadAll</span><span class="p">();</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><h1>See <a href="app.js.html">app.js</a> Next</h1>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr></tbody></table><div id="generated">generated Mon Jul 15 2013 00:01:25 GMT-0700 (PDT)  </div></div></body></html>