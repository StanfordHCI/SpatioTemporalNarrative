<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #navigation { height: 100%; width: 25%; float: left; }
      #map-canvas { height: 100%; width: 75%; float: right; }
      #streetViewDiv { height: 50%; }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDlt0o8X2fpZewMMy_9SdSxzbsdedLe8lw&sensor=false">
    </script>
    <script type="text/javascript">

      var map; 

      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(-34.397, 150.644),
          zoom: 12,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);
        afterInit();
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
    <div id="navigation">
      <input type="text" id="lat"/>
      <input type="text" id="long"/> 
      <input type="button" id="submitCoords" value="Show me on the map"/>
      <input type="button" id="streetViewButton" value="Take me to the streets"/>
      <input type="button" id="showArea" value="Show me the area"/>
      <input type="button" id="showDirections" value="Show me a route"/>
      <div id="streetViewDiv">
      </div>
      <div id="dataDiv">
      </div>
    </div>

    <div id="map-canvas"/> 
    </div>

  </body>
</html>

<script>
  
  var submit = document.getElementById("submitCoords"); 
  var longitude = 0.0; 
  var latitude = 0.0;

  submit.ontouchend = submit.onclick = function(event) {
    latitude = document.getElementById("lat").value; 
    longitude = document.getElementById("long").value; 
    var newCenter = new google.maps.LatLng(latitude, longitude); 
    map.panTo(newCenter); 
    var marker = new google.maps.Marker({
      position: newCenter,
      map: map,
      animation: google.maps.Animation.DROP,
      title: ""
    });
  }; 


  var streetDiv = document.getElementById("streetViewDiv");  
  var panorama = new google.maps.StreetViewPanorama(streetDiv); 

  var streetButton = document.getElementById("streetViewButton"); 
  streetButton.ontouchend = streetButton.onclick = function(event) {
    latitude = document.getElementById("lat").value; 
    longitude = document.getElementById("long").value;
    var streetLocation = new google.maps.LatLng(latitude, longitude); 
    //panorama.setPosition(streetLocation); 
    //map.panTo(streetLocation); 
    map.setStreetView(panorama); 
  }


  var areaButton = document.getElementById("showArea"); 
  areaButton.ontouchend = areaButton.onclick = function(event) {
    latitude = document.getElementById("lat").value; 
    longitude = document.getElementById("long").value;
    position = new google.maps.LatLng(latitude, longitude); 

    var marker = new google.maps.Marker({
      position: position,
      map: map,
      icon: {
        path: google.maps.SymbolPath.CIRCLE,
        fillOpacity: 0.5,
        fillColor: 'ff0000',
        strokeOpacity: 1.0,
        strokeColor: 'ff0000',
        strokeWeight: 3.0, 
        scale: 20 
      }
    });
  }


  var directionsButton = document.getElementById("showDirections"); 
  directionsButton.ontouchend = directionsButton.onclick = function(event) {
    var directionsService = new google.maps.DirectionsService(); 
    var directionsDisplay = new google.maps.DirectionsRenderer(); 
    directionsDisplay.setMap(map); 
    var start = new google.maps.LatLng(latitude, longitude); 
    var end = new google.maps.LatLng(document.getElementById("lat").value, document.getElementById("long").value); 
    var request = {
      origin: start,
      destination: end,
      travelMode: google.maps.DirectionsTravelMode.DRIVING
    };
    directionsService.route(request, function(response, status) {
      if (status == google.maps.DirectionsStatus.OK) {
        directionsDisplay.setDirections(response);
      }
    });
  }

</script>


<script>

var data = { 
  "title": "The Hunt for the Boston Bombing Suspects",

  "participants": {
    "Dzhokhar A. Tsarnaev": {
      "default":true
    },
    "Tamerlan Tsarnaev": {
    
    },
    "Danny": {

    },
    "Police Force":  {

    }
  },

  "events" : [
    {
    "title":"Campus Police Officer Shot",
    "time":"Thurs, 18 April 13 22:30:00 +0000", 
    "participants": ["Sean Collier", "Dzhokhar A. Tsarnaev", "Tamerlan Tsarnaev"],
    "spatial":"Stata Center, MIT",
    "narrative":  [
      {"type":"text", "value":"two men approach a campus police officer from behind and shoot him to death. The officer is found with multiple gunshot wounds and is taken to Massachusetts General Hospital in Boston, where he is pronounced dead. Police believe the officer was killed after a failed attempt by the suspects to steal his gun."}, 
      {"type":"fullimage","value":{"img":"mit.jpg", "text":"The scene near the M.I.T. campus"}}
    ]
    },
    {
      "title":"Armed Carjacking",
      "time":"Thurs, 18 April 13 22:45:00 +0000", 
      "participants":["Dzhokhar A. Tsarnaev", "Tamerlan Tsarnaev", "Danny"],
      "spatial":"Allston",
      "narrative":  [
        {"type":"text", "value":"A short time later, a man who officials believe was Tamerlan Tsarnaev approaches a parked Mercedes-Benz S.U.V., climbs in and points a gun at the driver, stating, \"Did you hear about the Boston explosion?\" and \"I did that,\" according to a criminal complaint filed April 22. The gunman forces the victim to drive to another location, where they pick up another man, who officials believe was Dzhokhar Tsarnaev."}
      ]
    },
    {
      "title":"Carjacking Victim Escapes",
      "time":"Thurs, 18 April 13 23:45:00 +0000", 
      "participants":["Dzhokhar A. Tsarnaev", "Tamerlan Tsarnaev", "Danny"],
      "spatial":"Memorial Drive Shell",
      "narrative":  [
        {"type":"text", "value":"The two men and the victim drive to a Shell gas station on Memorial Drive in Cambridge. The two men get out of the car, and the victim manages to escape."},
        {"type":"fullimage", "value":"shellsuspect.jpg"}
      ]
    },
    {
      "title":"Car Chase",
      "time":"Fri, 19 April 13 00:05:00 +0000", 
      "participants":["Dzhokhar A. Tsarnaev", "Tamerlan Tsarnaev", "Police Force"],
      "spatial":"Car Chase Area",
      "narrative":  [
        {"type":"text", "value":"The police immediately begin to search for the Mercedes, pursuing it into Watertown. During the chase, explosives are thrown from the vehicle."}
      ]
    }, 
    {
      "title":"Situation Escalates After Pursuit",
      "time":"", 
      "participants":["Dzhokhar A. Tsarnaev", "Tamerlan Tsarnaev", "Police Force"],
      "spatial":"Cordoned area of Watertown",
      "narrative":  [
        {"type":"text", "value":"Police follow the the Mercedes into Watertown"},
      ],
      "events":  [
        {
          "title":"Shooting and Killing of One Suspect",
        "time":"Fri, 19 April 13 00:50:00 +0000", 
        "participants":["Dzhokhar A. Tsarnaev", "Tamerlan Tsarnaev", "Police Force"],
        "spatial":"Dexter St Residential Area, Watertown",
        "narrative":  [
          {"type":"text", "value":"Suspects and the police exchange gunfire. A Watertown resident, Andrew Kitzenberg, 29, said he saw two men engaged in \"constant gunfire\" with police officers. A police S.U.V. \"drove towards the shooters,\" he said, and was shot at until it was severely damaged. Mr. Kitzenberg said he saw the shooters throw a bomb at the police, but it \"went 20 yards at most.\" One of the suspects, Tamerlan Tsarnaev, is tackled by the police and critically injured. He is pronounced dead at a hospital at 1:35 a.m. His brother, Dzhokhar A. Tsarnaev, gets back into the S.U.V. and drives at the officers, breaking through them."},
          {"type":"image", "value":"shootout.jpg"}
        ],
        },
        {
          "title":"Manhunt Continues For Second Suspect",
        "time":"", 
        "participants":["Dzhokhar A. Tsarnaev", "Tamerlan Tsarnaev", "Police Force"],
        "spatial":"Cordoned area of Watertown",
        "narrative":  [
          {"type":"text", "value":"The police begin a door to door search for Dzhokhar Tsarnaev. At a press conference about 12:30 p.m., Massachusetts State Police says that they have completed over “60 to 70 percent of what we want to cover.”"},
        ],
        }
      ]

    }, 
    {
      "title":"Suspect Taken Into Custody",
      "time":"Fri, 19 April 13 20:45:00 +0000", 
      "participants":["Dzhokhar A. Tsarnaev", "Police Force"],
      "spatial":"Tsarnaev Found",
      "narrative":  [
        {"type":"text", "value":"Friday evening, Dzhokhar Tsarnaev was taken into custody after a standoff with authorities in a residential area. Following a day of door-to-door searches, officers had swooped down on a residential block, focusing their attention on the backyard of a home there. Several blasts were heard around 7:50 p.m."},
        {"type":"image", "value":"final.jpg"}
      ],
    }
   ],

   "map":  {
      "type":"google",
      "poi": [
        {"type":"address",  "name":"Stata Center, MIT",           "value":"32 Vassar St Cambridge, MA 02139‎"},
        {"type":"address",  "name":"Allston",                 "value":"Allston, Boston, MA 02134"},
        {"type":"address",  "name":"Memorial Shell Drive",          "value":"820 Memorial Drive, Cambridge, MA 02139"},
        {"type":"area",   "name":"Car Chase Area",            "value":[{"type":"address", "value":"820 Memorial Drive, Cambridge, MA 02139"}, {"type":"address", "value":"Laurel St, Watertown, MA 02472"}, {"type":"address", "value":"Dexter St, Watertown, MA 02472"}]}, 
        {"type":"address",  "name":"Dexter St Residential Area, Watertown", "value":"Dexter St, Watertown, MA 02472"}, 
        {"type":"address",  "name":"Tsarnaev Found",            "value":"67 Franklin St, Watertown, MA 02472"}, 
        {"type":"area",   "name":"Watertown",               "value":[{"type":"point", "lat":42.370398, "long":-71.158962},{"type":"point", "lat":42.365388, "long":-71.159906},{"type":"point", "lat":42.364976, "long":-71.161752},{"type":"point", "lat":42.365007, "long":-71.164069},{"type":"point", "lat":42.363898, "long":-71.165271},{"type":"point", "lat":42.364088, "long":-71.167417},{"type":"point", "lat":42.365229, "long":-71.166601},{"type":"point", "lat":42.365356, "long":-71.168704},{"type":"point", "lat":42.366815, "long":-71.171021},{"type":"point", "lat":42.369859, "long":-71.171751},{"type":"point", "lat":42.370081, "long":-71.166773},{"type":"point", "lat":42.370905, "long":-71.16394},{"type":"point", "lat":42.371222, "long":-71.162353},{"type":"point", "lat":42.371285, "long":-71.160464}]}
      ]
   }
}; 

// var data = JSON.parse(text);

function afterInit() {

var geocoder = new google.maps.Geocoder(); 
function addressToCoordinates(address, callback) {
  var request = {
    address: address
  }
  geocoder.geocode(request, callback); 
}

var bounds = new google.maps.LatLngBounds(); 
function fitMarkedCoordinates(result, status) {
  if (status == google.maps.GeocoderStatus.OK) {
    var location = result[0].geometry.location;
    var marker = new google.maps.Marker({
      position: location, 
      map: map,
      animation: google.maps.Animation.DROP, 
      // title: poi.name  GET THIS WORKING WITH EACH NAME, instead of setting them all to the last name (CLOSURES!)
    });
    bounds.extend(location); 
  }
}

/*
var prevPoi = null; 
function callbackDrawPath(result, status) {
  console.log("Starting callback Draw Path"); 
  // callbackMarkCoordinates(result, status); 
  if (prevPoi != null) {
    var directionsService = new google.maps.DirectionsService(); 
    var directionsDisplay = new google.maps.DirectionsRenderer(); 
    directionsDisplay.setMap(map); 
    var start = new google.maps.LatLng(prevPoi); 
    var end = result[0].geometry.location; 
    var request = {
      origin: start,
      destination: end,
      travelMode: google.maps.DirectionsTravelMode.DRIVING
    };
    directionsService.route(request, function(result, status) {
      console.log("Geocode status: " + status); 
      if (status == google.maps.DirectionsStatus.OK) {
        directionsDisplay.setDirections(response);
        console.log("Set directions from: " + prevPoi + ", to: " + result[0].geometry.location);
      }
    });
  }
  prevPoi = result[0].geometry.location; 
  console.log("Saved previous point: " + prevPoi); 
}
*/
var directionsService = new google.maps.DirectionsService(); 

var bounds = new google.maps.LatLngBounds(); 
for (i in data.map.poi) {
  var poi = data.map.poi[i]; 
  if (poi.type == "address") {
    addressToCoordinates(poi.value, fitMarkedCoordinates); 
  } else if (poi.type == "area") {
    /*var locations = poi.value;
    var prevPoi = null; 
    for (j in locations) {
      var subPoi = locations[j]; 
      if (subPoi.type == "address") {
        addressToCoordinates(subPoi.value, callbackMarkCoordinates); 
        if (prevPoi != null) {
          var directionsDisplay = new google.maps.DirectionsRenderer(); 
          directionsDisplay.setMap(map); 
          var start = prevPoi; 
          var end = subPoi.value; 
          var request = {
            origin: start,
            destination: end,
            travelMode: google.maps.DirectionsTravelMode.DRIVING
          };

          console.log("Beginning directions request: start = " + request.origin + ", end = " + request.destination); 
          directionsService.route(request, function(response, status) {
            console.log("Direction service request status: " + status); 
            if (status == google.maps.DirectionsStatus.OK) {
              console.log(response); 
              directionsDisplay.setDirections(response);
            }
          });
        }
        prevPoi = subPoi.value; 
      } else if (subPoi.type == "point") {

      }
    }*/
  } else if (poi.type == "point") {

  }
}
map.fitBounds(bounds);

}

// Function to display/center on a given point, along with an array of points to keep visible 
// Barycentric coordinates
// focus on 2 points only for now
// load the points and give them IDs


</script>